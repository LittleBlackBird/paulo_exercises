<script>
    async function runPython() {
        let pyodide = await loadPyodide();

        let num = document.getElementById("num_problems").value;
        if (!num || num < 1) {
            alert("Zero não, Zé do Prego. Coloca outro número aí.");
        } else if (num > 21) {
            alert("This is too much, Paulo. Please enter a valid number.");
            return;
        }

        let pythonCode = `
import random

def division_problems(num):
    problems = []
    count = 0

    while count < num:
        dividend = random.randint(1000, 9999)
        divisor = random.randint(4, 9)

        if dividend % divisor == 0:
            answer = dividend // divisor
            problems.append((f"How much is {dividend} ÷ {divisor}?", answer))
            count += 1

    return problems

division_problems(int(${num}))
        `;

        try {
            let result = await pyodide.runPythonAsync(pythonCode);

            let problemList = document.getElementById("problems");
            problemList.innerHTML = "";

            for (let [question, answer] of result.toJs()) {
                const li = document.createElement("li");
                li.innerHTML = `
                    <span>${question}</span>
                    <input type="number" class="answer-input" placeholder="Your answer">
                    <button class="check-btn">Check</button>
                    <span class="feedback" style="margin-left: 10px;"></span>
                `;

                // Add event listener for the "Check" button
                li.querySelector(".check-btn").addEventListener("click", () => {
                    const userInput = li.querySelector(".answer-input").value;
                    const feedback = li.querySelector(".feedback");

                    if (parseInt(userInput) === answer) {
                        feedback.textContent = "✅ Correct!";
                        feedback.style.color = "green";
                    } else {
                        feedback.textContent = "❌ Try again.";
                        feedback.style.color = "red";
                    }
                });

                problemList.appendChild(li);
            }
        } catch (error) {
            console.error("Python Error:", error);
            alert("An error occurred while generating problems.");
        }
    }
</script>
